<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gibbonNetR">
<title>6. A complete working example • gibbonNetR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="6. A complete working example">
<meta property="og:description" content="gibbonNetR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gibbonNetR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01a-Overview.html">1a. Overview</a>
    <a class="dropdown-item" href="../articles/a01b-GettingStarted.html">1b. Getting Started</a>
    <a class="dropdown-item" href="../articles/a02-Trainingmulticlassmodels.html">2. Multiclass models</a>
    <a class="dropdown-item" href="../articles/a03-Trainingbinarymodels.html">3. Binary models</a>
    <a class="dropdown-item" href="../articles/a04-Automateddetection.html">4. Automated detection</a>
    <a class="dropdown-item" href="../articles/a05-UnsupervisedClustering.html">5. Unsupervised clustering</a>
    <a class="dropdown-item" href="../articles/a06-CompleteExample.html">6. A complete working example</a>
    <a class="dropdown-item" href="../articles/a07-JOSS%20figures.html">7. Recreate figures from JOSS article</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DenaJGibbon/gibbonNetR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>6. A complete working example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DenaJGibbon/gibbonNetR/blob/HEAD/vignettes/a06-CompleteExample.Rmd" class="external-link"><code>vignettes/a06-CompleteExample.Rmd</code></a></small>
      <div class="d-none name"><code>a06-CompleteExample.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="create-spectrogram-images-for-training">Create spectrogram images for training<a class="anchor" aria-label="anchor" href="#create-spectrogram-images-for-training"></a>
</h2>
<p>This example assumes you have downloaded the multiclass data as
explained here: <a href="https://denajgibbon.github.io/gibbonNetR/articles/a01b-GettingStarted.html" class="uri">https://denajgibbon.github.io/gibbonNetR/articles/a01b-GettingStarted.html</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://denajgibbon.github.io/gibbonNetR/">gibbonNetR</a></span><span class="op">)</span></span>
<span><span class="co"># Check folder composition</span></span>
<span><span class="va">TrainingDatapath</span> <span class="op">&lt;-</span> <span class="st">"data/trainingclips"</span></span>
<span></span>
<span><span class="co"># Create spectrogram images</span></span>
<span><span class="fu"><a href="../reference/spectrogram_images.html">spectrogram_images</a></span><span class="op">(</span></span>
<span>  trainingBasePath <span class="op">=</span> <span class="va">TrainingDatapath</span>,</span>
<span>  outputBasePath <span class="op">=</span> <span class="st">"data/trainingimages/"</span>,</span>
<span>  minfreq.khz <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  maxfreq.khz <span class="op">=</span> <span class="fl">1.6</span>,</span>
<span>  random <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># Assign proportion to training, validation, or test folders</span></span>
<span>  new.sampleratehz <span class="op">=</span> <span class="st">"NA"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check folder structure. There are two folders, train and valid.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/trainingimages/"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "train" "valid"</span></span></code></pre>
<p>We can check inside the train folder.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/trainingimages/train"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "female.gibbon"     "hornbill.helmeted" "hornbill.rhino"   </span></span>
<span><span class="co">## [4] "long.argus"        "noise"</span></span></code></pre>
<p>Then look at the first two image files.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/trainingimages/"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "train/female.gibbon/female.gibbon_S10_20180620_080003_1236.64391631774_1254.21379409804_.jpg"</span></span>
<span><span class="co">## [2] "train/female.gibbon/female.gibbon_S10_20180620_080003_1285.54514263521_1301.64286307873_.jpg"</span></span></code></pre>
<p>We also have our test dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/testimages/test/"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "female.gibbon/female.gibbon_SW1_20180304_060002_6813.17110142964_6822.1741043056_.jpg" </span></span>
<span><span class="co">## [2] "female.gibbon/female.gibbon_SW1_20180304_060002_6961.93442619326_6967.43748506342_.jpg"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="now-we-can-train-a-model-">Now we can train a model.<a class="anchor" aria-label="anchor" href="#now-we-can-train-a-model-"></a>
</h2>
<p>For this example we will specify the ‘resnet18’ architecture, as it
is the least complex of the ResNet architectures in this package and can
run faster. We will only train for 1 and 2 epochs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Location of spectrogram images for training</span></span>
<span><span class="va">input.data.path</span> <span class="op">&lt;-</span>  <span class="st">'data/trainingimages/'</span></span>
<span></span>
<span><span class="co"># Location of spectrogram images for testing</span></span>
<span><span class="va">test.data.path</span> <span class="op">&lt;-</span> <span class="st">'data/testimages/test/'</span></span>
<span></span>
<span><span class="co"># User specified training data label for metadata</span></span>
<span><span class="va">trainingfolder.short</span> <span class="op">&lt;-</span> <span class="st">'danummulticlassexample'</span></span>
<span></span>
<span><span class="co"># Specify the architecture type</span></span>
<span><span class="va">architecture</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'resnet18'</span><span class="op">)</span> <span class="co"># Choose from 'alexnet', 'vgg16', 'vgg19', 'resnet18', 'resnet50', or 'resnet152'.</span></span>
<span></span>
<span><span class="co"># We can specify the number of epochs to train here</span></span>
<span><span class="va">epoch.iterations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to train a multi-class CNN</span></span>
<span><span class="fu">gibbonNetR</span><span class="fu">::</span><span class="fu"><a href="../reference/train_CNN_multi.html">train_CNN_multi</a></span><span class="op">(</span>input.data.path<span class="op">=</span><span class="va">input.data.path</span>,</span>
<span>                            architecture <span class="op">=</span><span class="va">architecture</span>,</span>
<span>                            learning_rate <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                            class_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                            test.data<span class="op">=</span><span class="va">test.data.path</span>,</span>
<span>                            unfreeze.param <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            epoch.iterations<span class="op">=</span><span class="va">epoch.iterations</span>,</span>
<span>                            save.model<span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            early.stop <span class="op">=</span> <span class="st">"yes"</span>,</span>
<span>                            output.base.path <span class="op">=</span> <span class="st">"data/model_output/"</span>,</span>
<span>                            trainingfolder<span class="op">=</span><span class="va">trainingfolder.short</span>,</span>
<span>                            noise.category <span class="op">=</span> <span class="st">"noise"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="lossplot.png" style="width:50.0%" alt="Example loss plot from ’train_CNN_multi"><div class="figcaption">Example loss plot from ’train_CNN_multi</div>
</div>
<p>Now we can inspect the output in the ‘data/model_output’ folder.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/model_output/"</span>,recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_1_resnet18_logs_model.csv"                                                 </span></span>
<span><span class="co">## [2] "_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_1_resnet18_model.pt"                                                       </span></span>
<span><span class="co">## [3] "_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_2_resnet18_logs_model.csv"                                                 </span></span>
<span><span class="co">## [4] "_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_2_resnet18_model.pt"                                                       </span></span>
<span><span class="co">## [5] "_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_2_resnet18_output_TrainedModel_testdata.csv"                               </span></span>
<span><span class="co">## [6] "_danummulticlassexample_multi_unfrozen_TRUE_/performance_tables_multi/danummulticlassexample_1_resnet18_TransferLearningCNNDFMultiThreshold.csv"</span></span>
<span><span class="co">## [7] "_danummulticlassexample_multi_unfrozen_TRUE_/performance_tables_multi/danummulticlassexample_2_resnet18_TransferLearningCNNDFMultiThreshold.csv"</span></span>
<span><span class="co">## [8] "_danummulticlassexample_multi_unfrozen_TRUE_/resnet18_model_metadata.csv"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="now-we-can-evaluate-performance-">Now we can evaluate performance.<a class="anchor" aria-label="anchor" href="#now-we-can-evaluate-performance-"></a>
</h2>
<p>Once training is complete, we can assess the model’s performance
using the function get_best_performance(). This function retrieves the
model’s evaluation metrics and generates an F1-score plot. Since this is
a toy example, we would not expect great performance.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">performancetables.dir</span> <span class="op">&lt;-</span> <span class="st">'data/model_output/_danummulticlassexample_multi_unfrozen_TRUE_/performance_tables_multi'</span></span>
<span></span>
<span><span class="va">PerformanceOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_best_performance.html">get_best_performance</a></span><span class="op">(</span>performancetables.dir <span class="op">=</span> <span class="va">performancetables.dir</span>,</span>
<span>                       model.type <span class="op">=</span> <span class="st">"multi"</span>,</span>
<span>                       class <span class="op">=</span> <span class="st">"female.gibbon"</span>,</span>
<span>                       Thresh.val <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Evaluating performance for female.gibbon Here are the present classes: female.gibbonEvaluating performance for female.gibbon Here are the present classes: hornbill.helmetedEvaluating performance for female.gibbon Here are the present classes: hornbill.rhinoEvaluating performance for female.gibbon Here are the present classes: long.argus</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PerformanceOutput</span><span class="op">$</span><span class="va">f1_plot</span></span></code></pre></div>
<p><img src="a06-CompleteExample_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PerformanceOutput</span><span class="op">$</span><span class="va">best_f1</span><span class="op">$</span><span class="va">F1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.2226057</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PerformanceOutput</span><span class="op">$</span><span class="va">best_auc</span><span class="op">$</span><span class="va">AUC</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4679669</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="we-can-deploy-the-best-performing-model-over-a-longer-soundfile">We can deploy the best performing model over a longer soundfile<a class="anchor" aria-label="anchor" href="#we-can-deploy-the-best-performing-model-over-a-longer-soundfile"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example sound file </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"TempBinWav"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Save in temp directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/MultiDir/Wav/"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">T</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Write to temp directory</span></span>
<span>  <span class="fu">writeWave</span><span class="op">(</span><span class="va">TempBinWav</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/MultiDir/Wav/"</span>, <span class="st">"TempBinWav.wav"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Specify model path</span></span>
<span>  <span class="va">ModelPath</span> <span class="op">&lt;-</span> <span class="st">'data/model_output/_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_1_resnet18_model.pt'</span></span>
<span></span>
<span>  <span class="co"># Deploy trained model over sound files</span></span>
<span>  <span class="fu"><a href="../reference/deploy_CNN_multi.html">deploy_CNN_multi</a></span><span class="op">(</span></span>
<span>    clip_duration <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    architecture <span class="op">=</span> <span class="st">"alexnet"</span>,</span>
<span>    output_folder <span class="op">=</span> <span class="st">'data/Results/Images/'</span>,</span>
<span>    output_folder_selections <span class="op">=</span><span class="st">'data/Results/Selections/'</span>,</span>
<span>    output_folder_wav <span class="op">=</span> <span class="st">'data/Results/Wavs/'</span>,</span>
<span>    detect_pattern <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    top_model_path <span class="op">=</span> <span class="va">ModelPath</span>,</span>
<span>    path_to_files <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/MultiDir/Wav/"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    downsample_rate <span class="op">=</span> <span class="st">"NA"</span>,</span>
<span>    save_wav <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    class_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female.gibbon"</span>, <span class="st">"hornbill.helmeted"</span>, <span class="st">"hornbill.rhino"</span>, <span class="st">"long.argus"</span>, <span class="st">"noise"</span><span class="op">)</span>,</span>
<span>    noise_category <span class="op">=</span> <span class="st">"noise"</span>,</span>
<span>    single_class <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    single_class_category <span class="op">=</span> <span class="st">"female.gibbon"</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">.25</span>,</span>
<span>    max_freq_khz <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="0.76_female.gibbon_TempBinWav.wav_13_TopModel_.jpg" style="width:50.0%" alt="Spectrogram image of a detection from ‘deploy_CNN_multi’"><div class="figcaption">Spectrogram image of a detection from
‘deploy_CNN_multi’</div>
</div>
</div>
<div class="section level2">
<h2 id="extract-embeddings">Extract embeddings<a class="anchor" aria-label="anchor" href="#extract-embeddings"></a>
</h2>
<p>This function extracts embeddings from images and applies an
unsupervised clustering algorithm (hdbscan). Presently it serves as a
data visualization technique. Note that it might take a long time to run
on your computer.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Find model path</span></span>
<span> <span class="va">ModelPath</span> <span class="op">&lt;-</span> <span class="st">'data/model_output/_danummulticlassexample_multi_unfrozen_TRUE_/_danummulticlassexample_1_resnet18_model.pt'</span></span>
<span></span>
<span>  <span class="co"># Specify model path</span></span>
<span> <span class="va">ImageFilePath</span> <span class="op">&lt;-</span> <span class="st">'data/testimages/test/'</span></span>
<span></span>
<span>  <span class="co"># Function to extract and plot embeddings</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_embeddings.html">extract_embeddings</a></span><span class="op">(</span></span>
<span>    test_input <span class="op">=</span> <span class="va">ImageFilePath</span>,</span>
<span>    model_path <span class="op">=</span> <span class="va">ModelPath</span>,</span>
<span>    target_class <span class="op">=</span> <span class="st">"female.gibbon"</span>,</span>
<span>    unsupervised <span class="op">=</span> <span class="st">"TRUE"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">EmbeddingsCombined</span></span></code></pre></div>
<div class="float">
<img src="UnsupervisedPlot.png" style="width:75.0%" alt="Unsupervised clustering plot"><div class="figcaption">Unsupervised clustering plot</div>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>result<span class="sc">$</span>NMI</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.8275459</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="sc">&gt;</span> result<span class="sc">$</span>ConfusionMatrixUnsupervisedAssigment</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>         Sensitivity          Specificity       Pos Pred Value </span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>           <span class="fl">0.9407115</span>            <span class="fl">0.9933333</span>            <span class="fl">0.9694501</span> </span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>      Neg Pred Value            Precision               Recall </span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>           <span class="fl">0.9867550</span>            <span class="fl">0.9694501</span>            <span class="fl">0.9407115</span> </span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>                  F1           Prevalence       Detection Rate </span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>           <span class="fl">0.9548646</span>            <span class="fl">0.1835994</span>            <span class="fl">0.1727141</span> </span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>Detection Prevalence    Balanced Accuracy </span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>           <span class="fl">0.1781567</span>            <span class="fl">0.9670224</span> </span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dena J. Clink.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
