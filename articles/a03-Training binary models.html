<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. Binary models • gibbonNetR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Binary models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gibbonNetR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01-OverviewAndGettingStarted.html">1. Overview and Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/a02-Training%20multiclass%20models.html">2. Multiclass models</a></li>
    <li><a class="dropdown-item" href="../articles/a03-Training%20binary%20models.html">2. Binary models</a></li>
    <li><a class="dropdown-item" href="../articles/a04-Automated%20detection.html">3. Automated detection</a></li>
    <li><a class="dropdown-item" href="../articles/a05-UnsupervisedClustering.html">4. Unsupervised clustering</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. Binary models</h1>
            
      

      <div class="d-none name"><code>a03-Training binary models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<div class="section level3">
<h3 id="first-load-the-package">First load the package<a class="anchor" aria-label="anchor" href="#first-load-the-package"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://denajgibbon.github.io/gibbonNetR/">gibbonNetR</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="we-create-spectrogram-images-of-the-sound-files-">We create spectrogram images of the sound files.<a class="anchor" aria-label="anchor" href="#we-create-spectrogram-images-of-the-sound-files-"></a>
</h3>
<p>To follow best practices we want to use training and test data from
different passive acoustic monitoring arrays These clips are from Danum
Valley Conservation Area, Sabah, Malaysia, but are taken from two
different arrays. The “spectrogram_images” function takes folders
organized and labeled by signal type, and creates training, validation,
or test folders using the “splits” specified in the function call. In
the example below 70% of the data is used for training and 30% for
validation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Link to training clips on Zenodo</span></span>
<span><span class="va">ZenodoLink</span> <span class="op">&lt;-</span> <span class="st">'https://zenodo.org/records/14213067/files/trainingclipsbinary.zip?download=1'</span></span>
<span></span>
<span><span class="co"># Download into specified zip file location</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">ZenodoLink</span>, destfile <span class="op">=</span> <span class="st">'data/trainingclipsbinary.zip'</span>,method<span class="op">=</span><span class="st">'curl'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unzip folder</span></span>
<span><span class="va">exdir</span> <span class="op">&lt;-</span> <span class="st">'data/'</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">'data/trainingclipsbinary.zip'</span>, exdir <span class="op">=</span> <span class="va">exdir</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check folder composition</span></span>
<span><span class="va">TrainingDatapath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">exdir</span>,<span class="st">"trainingclipsbinary"</span>,sep<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check folder names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">TrainingDatapath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create spectrogram images</span></span>
<span><span class="fu"><a href="../reference/spectrogram_images.html">spectrogram_images</a></span><span class="op">(</span></span>
<span>   trainingBasePath <span class="op">=</span> <span class="va">TrainingDatapath</span>,</span>
<span>   outputBasePath <span class="op">=</span> <span class="st">'data/trainingimagesbinary/'</span>,</span>
<span>   minfreq.khz <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>   maxfreq.khz <span class="op">=</span> <span class="fl">1.6</span>,</span>
<span>   random<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>   splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># Assign proportion to training, validation, or test folders</span></span>
<span>   new.sampleratehz <span class="op">=</span> <span class="st">'NA'</span></span>
<span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-example-test-files-on-zenodo-and-convert-to-spectrogram-images">Download example test files on Zenodo and convert to spectrogram
images<a class="anchor" aria-label="anchor" href="#download-example-test-files-on-zenodo-and-convert-to-spectrogram-images"></a>
</h3>
<p>The “spectrogram_images” function below puts 100% of the test images
into the test folder.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://denajgibbon.github.io/gibbonNetR/">gibbonNetR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Link to training clips on Zenodo</span></span>
<span><span class="va">ZenodoLink</span> <span class="op">&lt;-</span> <span class="st">'https://zenodo.org/records/14213067/files/testclipsbinary.zip?download=1'</span></span>
<span></span>
<span><span class="co"># Download into specified zip file location</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">ZenodoLink</span>, destfile <span class="op">=</span> <span class="st">'data/testclipsbinary.zip'</span>,method<span class="op">=</span><span class="st">'curl'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unzip folder</span></span>
<span><span class="va">exdir</span> <span class="op">&lt;-</span> <span class="st">'data/'</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">'data/testclipsbinary.zip'</span>, exdir <span class="op">=</span> <span class="va">exdir</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check folder composition</span></span>
<span><span class="va">TestDatapath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">exdir</span>,<span class="st">"testclipsbinary"</span>,sep<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check folder names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">TestDatapath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create spectorgram images</span></span>
<span><span class="fu"><a href="../reference/spectrogram_images.html">spectrogram_images</a></span><span class="op">(</span></span>
<span>   trainingBasePath <span class="op">=</span> <span class="va">TestDatapath</span>,</span>
<span>   outputBasePath <span class="op">=</span> <span class="st">'data/testimagesbinary/'</span>,</span>
<span>   minfreq.khz <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>   maxfreq.khz <span class="op">=</span> <span class="fl">1.6</span>,</span>
<span>   splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Assign proportion to training, validation, or test folders</span></span>
<span>   new.sampleratehz <span class="op">=</span> <span class="st">'NA'</span></span>
<span> <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-training">Model training<a class="anchor" aria-label="anchor" href="#model-training"></a>
</h2>
<p>We will now train a binary model. We will use the spectrogram images
for training, test and validation that we created above. Note that for
“input.data.path” the train and valid folders need to be there. For the
test data, the path must contain the ‘test’ folder. You can specify
multiple model architectures and number of epochs for training.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Location of spectrogram images for training</span></span>
<span><span class="va">input.data.path</span> <span class="op">&lt;-</span>  <span class="st">'data/trainingimagesbinary/'</span></span>
<span></span>
<span><span class="co"># Location of spectrogram images for testing</span></span>
<span><span class="va">test.data.path</span> <span class="op">&lt;-</span> <span class="st">'data/testimagesbinary/test/'</span></span>
<span></span>
<span><span class="co"># User specified training data label for metadata</span></span>
<span><span class="va">trainingfolder.short</span> <span class="op">&lt;-</span> <span class="st">'danummbinaryexample'</span></span>
<span></span>
<span><span class="co"># Specify the architecture type</span></span>
<span><span class="va">architectures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'alexnet'</span>,<span class="st">'resnet50'</span><span class="op">)</span> <span class="co"># Choose 'alexnet', 'vgg16', 'vgg19', 'resnet18', 'resnet50', or 'resnet152'</span></span>
<span></span>
<span><span class="co"># We can specify the number of epochs to train here</span></span>
<span><span class="va">epoch.iterations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to train a multi-class CNN</span></span>
<span><span class="fu">gibbonNetR</span><span class="fu">::</span><span class="fu"><a href="../reference/train_CNN_binary.html">train_CNN_binary</a></span><span class="op">(</span></span>
<span>      input.data.path <span class="op">=</span> <span class="va">input.data.path</span>,</span>
<span>      noise.weight <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>      architecture <span class="op">=</span> <span class="va">architectures</span>,</span>
<span>      save.model <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      learning_rate <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>      test.data <span class="op">=</span> <span class="va">test.data.path</span>,</span>
<span>      batch_size <span class="op">=</span> <span class="fl">32</span>,</span>
<span>      unfreeze.param <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      <span class="co"># FALSE means the features are frozen</span></span>
<span>      epoch.iterations <span class="op">=</span> <span class="va">epoch.iterations</span>,</span>
<span>      list.thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span>,</span>
<span>      early.stop <span class="op">=</span> <span class="st">"yes"</span>,</span>
<span>      output.base.path <span class="op">=</span> <span class="st">'data/model_output_binary/'</span>,</span>
<span>      trainingfolder <span class="op">=</span> <span class="va">trainingfolder.short</span>,</span>
<span>      positive.class <span class="op">=</span> <span class="st">"female.gibbon"</span>,</span>
<span>      negative.class <span class="op">=</span> <span class="st">"noise"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-evaluation">Model evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"></a>
</h2>
<div class="section level3">
<h3 id="specify-for-the-female-gibbon-class">Specify for the ‘female.gibbon’ class<a class="anchor" aria-label="anchor" href="#specify-for-the-female-gibbon-class"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Evaluate model performance</span></span>
<span><span class="va">performancetables.dir</span> <span class="op">&lt;-</span> <span class="st">"data/model_output_binary/_danummbinaryexample_binary_unfrozen_TRUE_/performance_tables"</span></span>
<span></span>
<span><span class="va">PerformanceOutput</span> <span class="op">&lt;-</span> <span class="fu">gibbonNetR</span><span class="fu">::</span><span class="fu"><a href="../reference/get_best_performance.html">get_best_performance</a></span><span class="op">(</span>performancetables.dir<span class="op">=</span><span class="va">performancetables.dir</span>,</span>
<span>                                                      class<span class="op">=</span><span class="st">'female.gibbon'</span>,</span>
<span>                                                      model.type <span class="op">=</span> <span class="st">"binary"</span>,Thresh.val<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="examine-the-results">Examine the results<a class="anchor" aria-label="anchor" href="#examine-the-results"></a>
</h3>
<p>Here we get decent performance forr the threshold dependent metrics,
AUC is still not great.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>f1_plot</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>best_recall<span class="sc">$</span>Recall</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>best_f1<span class="sc">$</span>F1</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9884259</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>best_auc<span class="sc">$</span>AUC</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.4363169</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>best_precision<span class="sc">$</span>Precision</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9907193</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>PerformanceOutput<span class="sc">$</span>best_recall<span class="sc">$</span>Recall</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<img src="binary_eval.png" align="center" width="50%" height="50%"><figcaption><p>“Output from ‘get_best_performance’ fuction”</p>
</figcaption>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dena J. Clink.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
